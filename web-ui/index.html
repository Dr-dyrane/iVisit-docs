<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iVisit Document Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        :root {
            --primary: 86, 16, 30;
            --secondary: 11, 81, 47;
            --accent: 248, 113, 113;
            --background: 250, 250, 250;
            --foreground: 55, 65, 81;
            --font-inter: 'Inter', sans-serif;
        }
        
        body {
            font-family: var(--font-inter), -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #86100E 0%, #0B0F1A 100%);
            min-height: 100vh;
        }
        
        .glass-morphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }
    </style>
</head>
<body class="text-white">
    <!-- Navigation -->
    <nav class="fixed top-0 left-0 right-0 z-50 glass-morphism">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-red-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-ambulance text-white text-sm"></i>
                    </div>
                    <h1 class="text-xl font-bold">iVisit Document Generator</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="toggleTheme()" class="p-2 rounded-lg hover:bg-white/20 transition-colors">
                        <i class="fas fa-moon" id="themeIcon"></i>
                    </button>
                    <button onclick="showKeyboardShortcuts()" class="p-2 rounded-lg hover:bg-white/20 transition-colors">
                        <i class="fas fa-keyboard"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-24 pb-12 px-6">
        <div class="container mx-auto max-w-4xl">
            <!-- Hero Section -->
            <section class="text-center mb-16">
                <div class="animate-float">
                    <div class="inline-flex items-center justify-center w-20 h-20 bg-red-600 rounded-2xl mb-6 animate-pulse-slow">
                        <i class="fas fa-file-alt text-white text-3xl"></i>
                    </div>
                </div>
                <h2 class="text-4xl md:text-6xl font-bold mb-6 tracking-tight">
                    Generate Professional Documents<br>
                    <span class="text-red-400">with AI Precision</span>
                </h2>
                <p class="text-xl text-gray-300 mb-8 max-w-2xl mx-auto">
                    Transform your iVisit codebase into business proposals, technical documentation, and legal documents with Apple-level design quality.
                </p>
            </section>

            <!-- Generator Interface -->
            <section class="grid md:grid-cols-2 gap-8 mb-12">
                <!-- Input Panel -->
                <div class="glass-morphism rounded-2xl p-8">
                    <h3 class="text-2xl font-bold mb-6 flex items-center">
                        <i class="fas fa-magic mr-3 text-red-400"></i>
                        Document Request
                    </h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Document Type</label>
                            <select id="docType" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:border-red-400 focus:outline-none focus:ring-2 focus:ring-red-400/50 transition-all">
                                <option value="business">Business Proposal</option>
                                <option value="privacy">Privacy Policy</option>
                                <option value="prd">Product Requirements</option>
                                <option value="technical">Technical Documentation</option>
                                <option value="api">API Documentation</option>
                                <option value="legal">Legal Document</option>
                                <option value="custom">Custom Request</option>
                            </select>
                        </div>
                        
                        <div id="customPromptDiv" class="hidden">
                            <label class="block text-sm font-medium mb-2">Custom Prompt</label>
                            <textarea id="customPrompt" rows="4" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:border-red-400 focus:outline-none focus:ring-2 focus:ring-red-400/50 transition-all resize-none" placeholder="Describe the document you want to generate..."></textarea>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <label class="flex items-center">
                                <input type="checkbox" id="useSupabase" class="mr-2 rounded">
                                <span class="text-sm">Use Supabase Memory</span>
                            </label>
                            <button onclick="generateDocument()" class="px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors flex items-center">
                                <i class="fas fa-rocket mr-2"></i>
                                Generate
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Status Panel -->
                <div class="glass-morphism rounded-2xl p-8">
                    <h3 class="text-2xl font-bold mb-6 flex items-center">
                        <i class="fas fa-chart-line mr-3 text-green-400"></i>
                        Generation Status
                    </h3>
                    
                    <div id="statusPanel" class="space-y-4">
                        <div class="text-center py-8">
                            <i class="fas fa-inbox text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-300">Ready to generate documents</p>
                        </div>
                    </div>
                    
                    <!-- Recent Documents -->
                    <div class="mt-8">
                        <h4 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-history mr-2 text-blue-400"></i>
                            Recent Documents
                        </h4>
                        <div id="recentDocs" class="space-y-2">
                            <p class="text-gray-400 text-sm">No documents generated yet</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Features Section -->
            <section class="glass-morphism rounded-2xl p-8 mb-12">
                <h3 class="text-2xl font-bold mb-6 text-center">Features</h3>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-bolt text-white text-2xl"></i>
                        </div>
                        <h4 class="font-semibold mb-2">Ultra-Fast</h4>
                        <p class="text-gray-300 text-sm">Generate documents in seconds with Claude Opus 4.6</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-palette text-white text-2xl"></i>
                        </div>
                        <h4 class="font-semibold mb-2">Beautiful Design</h4>
                        <p class="text-gray-300 text-sm">Apple-level formatting with iVisit branding</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-database text-white text-2xl"></i>
                        </div>
                        <h4 class="font-semibold mb-2">Smart Memory</h4>
                        <p class="text-gray-300 text-sm">Supabase integration for context-aware generation</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Keyboard Shortcuts Modal -->
    <div id="shortcutsModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-6">
            <div class="glass-morphism rounded-2xl p-8 max-w-md w-full">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-bold">Keyboard Shortcuts</h3>
                    <button onclick="hideKeyboardShortcuts()" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span><i class="fas fa-keyboard mr-2 text-blue-400"></i>Ctrl + P</span>
                        <span class="text-gray-300">Print Document</span>
                    </div>
                    <div class="flex justify-between">
                        <span><i class="fas fa-keyboard mr-2 text-blue-400"></i>Ctrl + G</span>
                        <span class="text-gray-300">Generate Document</span>
                    </div>
                    <div class="flex justify-between">
                        <span><i class="fas fa-keyboard mr-2 text-blue-400"></i>Ctrl + K</span>
                        <span class="text-gray-300">Show Shortcuts</span>
                    </div>
                    <div class="flex justify-between">
                        <span><i class="fas fa-keyboard mr-2 text-blue-400"></i>ESC</span>
                        <span class="text-gray-300">Close Modal</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Print View (Hidden by default) -->
    <div id="printView" class="fixed inset-0 bg-white z-50 hidden">
        <div class="h-full overflow-auto p-8">
            <div class="max-w-4xl mx-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="printTitle" class="text-3xl font-bold text-gray-900"></h2>
                    <button onclick="closePrintView()" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition-colors">
                        <i class="fas fa-times mr-2"></i>
                        Close
                    </button>
                </div>
                <div id="printContent" class="prose max-w-none"></div>
            </div>
        </div>
    </div>

    <script>
        let currentDocument = null;
        let isDarkMode = true;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadRecentDocuments();
            setupKeyboardShortcuts();
            updateDocTypePrompt();
        });

        // Keyboard shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key.toLowerCase()) {
                        case 'p':
                            e.preventDefault();
                            if (currentDocument) {
                                printDocument();
                            }
                            break;
                        case 'g':
                            e.preventDefault();
                            generateDocument();
                            break;
                        case 'k':
                            e.preventDefault();
                            showKeyboardShortcuts();
                            break;
                    }
                }
                
                if (e.key === 'Escape') {
                    hideKeyboardShortcuts();
                    closePrintView();
                }
            });
        }

        // Document type change
        document.getElementById('docType').addEventListener('change', updateDocTypePrompt);

        function updateDocTypePrompt() {
            const docType = document.getElementById('docType').value;
            const customDiv = document.getElementById('customPromptDiv');
            
            if (docType === 'custom') {
                customDiv.classList.remove('hidden');
            } else {
                customDiv.classList.add('hidden');
            }
        }

        // Generate document
        async function generateDocument() {
            const docType = document.getElementById('docType').value;
            const useSupabase = document.getElementById('useSupabase').checked;
            
            let prompt = '';
            if (docType === 'custom') {
                prompt = document.getElementById('customPrompt').value;
                if (!prompt.trim()) {
                    showStatus('Please enter a custom prompt', 'error');
                    return;
                }
            } else {
                const prompts = {
                    business: 'Generate a comprehensive business proposal for iVisit emergency medical platform',
                    privacy: 'Generate a complete privacy policy for the iVisit emergency medical application',
                    prd: 'Generate product requirements document for iVisit backend APIs and features',
                    technical: 'Generate technical documentation for iVisit platform architecture',
                    api: 'Generate API documentation for iVisit backend services',
                    legal: 'Generate legal terms of service for iVisit medical platform'
                };
                prompt = prompts[docType];
            }

            showStatus('Connecting to Claude API...', 'loading');
            
            try {
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        useSupabase: useSupabase
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    currentDocument = result.document;
                    showStatus('Document generated successfully!', 'success');
                    addRecentDocument(result.document);
                    showPrintView(result.document);
                } else {
                    showStatus(result.error || 'Generation failed', 'error');
                }
            } catch (error) {
                showStatus('Connection error: ' + error.message, 'error');
            }
        }

        // Status display
        function showStatus(message, type) {
            const statusPanel = document.getElementById('statusPanel');
            const icons = {
                loading: '<i class="fas fa-spinner fa-spin text-3xl text-blue-400 mb-4"></i>',
                success: '<i class="fas fa-check-circle text-3xl text-green-400 mb-4"></i>',
                error: '<i class="fas fa-exclamation-triangle text-3xl text-red-400 mb-4"></i>'
            };
            
            statusPanel.innerHTML = `
                <div class="text-center py-8">
                    ${icons[type]}
                    <p class="text-gray-300">${message}</p>
                </div>
            `;
        }

        // Recent documents
        function loadRecentDocuments() {
            const recent = localStorage.getItem('recentDocuments');
            if (recent) {
                const documents = JSON.parse(recent);
                updateRecentDocuments(documents);
            }
        }

        function addRecentDocument(doc) {
            const recent = localStorage.getItem('recentDocuments');
            const documents = recent ? JSON.parse(recent) : [];
            
            // Add to beginning and keep only last 5
            documents.unshift({
                title: doc.title,
                content: doc.content,
                timestamp: new Date().toISOString()
            });
            
            const updated = documents.slice(0, 5);
            localStorage.setItem('recentDocuments', JSON.stringify(updated));
            updateRecentDocuments(updated);
        }

        function updateRecentDocuments(documents) {
            const recentDiv = document.getElementById('recentDocs');
            
            if (documents.length === 0) {
                recentDiv.innerHTML = '<p class="text-gray-400 text-sm">No documents generated yet</p>';
                return;
            }
            
            recentDiv.innerHTML = documents.map((doc, index) => `
                <div class="flex items-center justify-between p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-colors cursor-pointer" onclick="loadDocument(${index})">
                    <div class="flex-1">
                        <h5 class="font-medium text-sm">${doc.title}</h5>
                        <p class="text-xs text-gray-400">${new Date(doc.timestamp).toLocaleDateString()}</p>
                    </div>
                    <i class="fas fa-file-alt text-gray-400"></i>
                </div>
            `).join('');
        }

        function loadDocument(index) {
            const recent = localStorage.getItem('recentDocuments');
            const documents = recent ? JSON.parse(recent) : [];
            
            if (documents[index]) {
                currentDocument = documents[index];
                showPrintView(documents[index]);
            }
        }

        // Print view
        function showPrintView(document) {
            const printView = document.getElementById('printView');
            const printTitle = document.getElementById('printTitle');
            const printContent = document.getElementById('printContent');
            
            printTitle.textContent = document.title;
            
            // Check if content is JSON or Markdown
            let contentToDisplay = document.content;
            
            // Try to parse as JSON first
            try {
                const parsed = JSON.parse(document.content);
                if (parsed.content) {
                    contentToDisplay = parsed.content;
                }
            } catch (e) {
                // It's already markdown, use as-is
                contentToDisplay = document.content;
            }
            
            printContent.innerHTML = marked ? marked(contentToDisplay) : contentToDisplay.replace(/\n/g, '<br>');
            
            printView.classList.remove('hidden');
        }

        function closePrintView() {
            document.getElementById('printView').classList.add('hidden');
        }

        function printDocument() {
            if (currentDocument) {
                const printContent = document.getElementById('printContent');
                const printWindow = window.open('', '_blank');
                
                printWindow.document.write(`
                    <html>
                        <head>
                            <title>${currentDocument.title}</title>
                            <style>
                                body { font-family: 'Inter', sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; }
                                h1, h2, h3 { color: #86100E; margin-top: 2em; }
                                h1 { font-size: 2em; }
                                h2 { font-size: 1.5em; }
                                h3 { font-size: 1.2em; }
                                code { background: #f1f5f9; padding: 2px 4px; border-radius: 4px; }
                                pre { background: #f8f9fa; padding: 1em; border-radius: 8px; overflow-x: auto; }
                                @media print { body { padding: 0; } }
                            </style>
                        </head>
                        <body>
                            ${printContent.innerHTML}
                        </body>
                    </html>
                `);
                
                printWindow.document.close();
                printWindow.print();
            }
        }

        // UI Functions
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            const icon = document.getElementById('themeIcon');
            icon.className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
            // Theme toggle implementation would go here
        }

        function showKeyboardShortcuts() {
            document.getElementById('shortcutsModal').classList.remove('hidden');
        }

        function hideKeyboardShortcuts() {
            document.getElementById('shortcutsModal').classList.add('hidden');
        }

        // Load marked.js for markdown parsing
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/marked/marked.min.js';
        document.head.appendChild(script);
    </script>
</body>
</html>
